{"version":3,"file":"controller/view.js","mappings":"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","sources":["webpack://@pewresearch/prc-chart-builder/./src/controller/view.js"],"sourcesContent":["/**\n * WordPress Dependencies\n */\nimport { store, getElement, getContext } from '@wordpress/interactivity';\n\nconst { addQueryArgs } = window.wp.url;\nconst { innerWidth, innerHeight } = window;\n\n// convert array of arrays to formatted csv, with optional metadata\n// @see https://github.com/pewresearch/prc-scripts/blob/main/src/@prc/functions/functions.js#L145\nfunction arrayToCSV(objArray, metadata) {\n\tif (undefined === objArray || objArray.length === 0) return false;\n\tconst array =\n\t\t'object' !== typeof objArray ? JSON.parse(objArray) : objArray;\n\tconst checkIfEmpty = (str) => (str !== undefined ? str : '');\n\tlet str = '';\n\tif (undefined !== metadata) {\n\t\tstr += `${checkIfEmpty(metadata.title)}\n\t\t\t${checkIfEmpty(metadata.subtitle)}\n\n\t\t\t`;\n\t}\n\tfor (let i = 0; i < array.length; i += 1) {\n\t\tlet line = '';\n\t\t// if a value has a comma in it, wrap it in quotes\n\t\tfor (let j = 0; j < array[i].length; j += 1) {\n\t\t\tif (j > 0) line += ',';\n\t\t\tif (array[i][j].indexOf(',') > -1) {\n\t\t\t\tline += `\"${array[i][j]}\"`;\n\t\t\t} else {\n\t\t\t\tline += array[i][j];\n\t\t\t}\n\t\t}\n\n\t\tstr += `${line}\n\t\t`;\n\t}\n\tif (undefined !== metadata) {\n\t\tstr += `\n\t\t${checkIfEmpty(metadata.note)}\n\t\t${checkIfEmpty(metadata.source)}\n\t\t${checkIfEmpty(metadata.tag)}`;\n\t}\n\treturn str;\n}\n\nconst { state, actions } = store('prc-block/chart-builder-controller', {\n\tstate: {\n\t\tget isActive() {\n\t\t\tconst context = getContext();\n\t\t\tconst { id } = context;\n\t\t\tconst element = getElement();\n\t\t\treturn (\n\t\t\t\telement.attributes['data-chart-view'] === state[id].activeTab ||\n\t\t\t\t(element.attributes['data-allow-overlay'] &&\n\t\t\t\t\tstate[id].activeTab === 'share')\n\t\t\t);\n\t\t},\n\t},\n\tcallbacks: {\n\t\tdetectWebShareSupport() {\n\t\t\tif (window.navigator.share === undefined) {\n\t\t\t\tstate.webShareSupported = false;\n\t\t\t} else {\n\t\t\t\tstate.webShareSupported = true;\n\t\t\t}\n\t\t},\n\t},\n\tactions: {\n\t\tsetActiveTab(event) {\n\t\t\tevent.preventDefault();\n\t\t\tconst context = getContext();\n\t\t\tconst { id } = context;\n\t\t\tconst element = getElement();\n\t\t\t// if the active tab is share and the native share is supported, do onShareClick\n\t\t\tif (\n\t\t\t\telement.attributes['data-chart-view'] === 'share' &&\n\t\t\t\tstate.webShareSupported\n\t\t\t) {\n\t\t\t\tactions.shareNative();\n\t\t\t} else {\n\t\t\t\t// otherwise, set the active tab to the current tab\n\t\t\t\tstate[id].activeTab = element.attributes['data-chart-view'];\n\t\t\t}\n\t\t},\n\t\thideModal() {\n\t\t\tconst context = getContext();\n\t\t\tconst { id } = context;\n\t\t\tstate[id].activeTab = 'chart';\n\t\t},\n\t\tshareNative: () => {\n\t\t\tconst context = getContext();\n\t\t\tconst { postId, postUrl, rootUrl, title, featuredImageId } =\n\t\t\t\tcontext;\n\t\t\tconst url = featuredImageId\n\t\t\t\t? `${rootUrl}/share/${postId}/${featuredImageId}`\n\t\t\t\t: postUrl;\n\n\t\t\tif (true === state.webShareSupported) {\n\t\t\t\twindow.navigator.share({\n\t\t\t\t\ttitle: title + ' | Pew Research Center',\n\t\t\t\t\turl: url,\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\t\tshareTwitter() {\n\t\t\tconst context = getContext();\n\t\t\tconst { postId, postUrl, rootUrl, title, featuredImageId } =\n\t\t\t\tcontext;\n\t\t\tconst actionUrl = addQueryArgs('https://twitter.com/intent/tweet', {\n\t\t\t\ttext: title,\n\t\t\t\turl: featuredImageId\n\t\t\t\t\t? `${rootUrl}/share/${postId}/${featuredImageId}`\n\t\t\t\t\t: postUrl,\n\t\t\t});\n\t\t\twindow.open(\n\t\t\t\tactionUrl,\n\t\t\t\t'twtrShareWindow',\n\t\t\t\t`height=450, width=550, top=${innerHeight / 2 - 275}, left=${\n\t\t\t\t\tinnerWidth / 2 - 225\n\t\t\t\t}, toolbar=0, location=0, menubar=0, directories=0, scrollbars=0`\n\t\t\t);\n\t\t},\n\t\tshareBluesky() {\n\t\t\tconst context = getContext();\n\t\t\tconst { postId, postUrl, rootUrl, title, featuredImageId } =\n\t\t\t\tcontext;\n\t\t\tconst url = featuredImageId\n\t\t\t\t? `${rootUrl}/share/${postId}/${featuredImageId}`\n\t\t\t\t: postUrl;\n\t\t\tconst actionUrl = addQueryArgs('https://bsky.app/intent/compose', {\n\t\t\t\ttext: `${title} ${url}`,\n\t\t\t});\n\t\t\twindow.open(\n\t\t\t\tactionUrl,\n\t\t\t\t'bskyShareWindow',\n\t\t\t\t`height=450, width=550, top=${innerHeight / 2 - 275}, left=${\n\t\t\t\t\tinnerWidth / 2 - 225\n\t\t\t\t}, toolbar=0, location=0, menubar=0, directories=0, scrollbars=0`\n\t\t\t);\n\t\t},\n\t\tshareFacebook() {\n\t\t\tconst context = getContext();\n\t\t\tconst { postId, postUrl, rootUrl, featuredImageId } = context;\n\t\t\tconst actionUrl = addQueryArgs(\n\t\t\t\t'https://www.facebook.com/sharer/sharer.php',\n\t\t\t\t{\n\t\t\t\t\tu: featuredImageId\n\t\t\t\t\t\t? `${rootUrl}/share/${postId}/${featuredImageId}`\n\t\t\t\t\t\t: postUrl,\n\t\t\t\t}\n\t\t\t);\n\t\t\twindow.open(\n\t\t\t\tactionUrl,\n\t\t\t\t'fbShareWindow',\n\t\t\t\t`height=450, width=550, top=${innerHeight / 2 - 275}, left=${\n\t\t\t\t\tinnerWidth / 2 - 225\n\t\t\t\t}, toolbar=0, location=0, menubar=0, directories=0, scrollbars=0`\n\t\t\t);\n\t\t},\n\t\tdownloadData(event) {\n\t\t\tconst context = getContext();\n\t\t\tconst {\n\t\t\t\ttableData,\n\t\t\t\ttitle,\n\t\t\t\tsubtitle,\n\t\t\t\tnote,\n\t\t\t\tsource,\n\t\t\t\ttag,\n\t\t\t\tpostPubDate,\n\t\t\t} = context;\n\t\t\t// If the event is a keydown event and the key is not Enter or space, return\n\t\t\tif (\n\t\t\t\tevent.type === 'keydown' &&\n\t\t\t\t(event.key !== 'Enter' || event.key !== ' ')\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!tableData) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst csv = arrayToCSV([tableData.header, ...tableData.rows], {\n\t\t\t\ttitle,\n\t\t\t\tsubtitle,\n\t\t\t\tnote,\n\t\t\t\tsource,\n\t\t\t\ttag,\n\t\t\t});\n\t\t\tconst blob = new Blob([csv], { type: 'text/csv' });\n\t\t\tconst url = URL.createObjectURL(blob);\n\t\t\tconst downloadLink = document.createElement('a');\n\t\t\tconst csvTitle = title.toLowerCase().replace(/\\s+/g, '_');\n\t\t\tdownloadLink.setAttribute('href', url);\n\t\t\tdownloadLink.setAttribute(\n\t\t\t\t'download',\n\t\t\t\t`${csvTitle}_data_${postPubDate}.csv`\n\t\t\t);\n\t\t\tdownloadLink.click();\n\t\t},\n\t\tdownloadSVG() {\n\t\t\tconst context = getContext();\n\t\t\tconst { id } = context;\n\t\t\tconst controllerEl = document.getElementById(id);\n\t\t\tconst svg = controllerEl.querySelector('svg');\n\t\t\tsvg.setAttribute('xmlns', 'http://www.w3.org/2000/svg');\n\t\t\tsvg.setAttribute('xmlns:xlink', 'http://www.w3.org/1999/xlink');\n\t\t\tconst blob = new Blob([svg.outerHTML], { type: 'image/svg+xml' });\n\t\t\tconst url = URL.createObjectURL(blob);\n\t\t\tconst downloadLink = document.createElement('a');\n\t\t\tdownloadLink.href = url;\n\t\t\tdownloadLink.download = `chart-${id}.svg`;\n\t\t\tdocument.body.appendChild(downloadLink);\n\t\t\tdownloadLink.click();\n\t\t\tdocument.body.removeChild(downloadLink);\n\t\t},\n\t},\n});\n"],"names":["addQueryArgs","window","wp","url","innerWidth","innerHeight","state","actions","store","isActive","context","getContext","id","element","getElement","attributes","activeTab","callbacks","detectWebShareSupport","undefined","navigator","share","webShareSupported","setActiveTab","event","preventDefault","shareNative","hideModal","postId","postUrl","rootUrl","title","featuredImageId","shareTwitter","actionUrl","text","open","shareBluesky","shareFacebook","u","downloadData","tableData","subtitle","note","source","tag","postPubDate","type","key","csv","objArray","metadata","length","array","checkIfEmpty","str","i","line","j","indexOf","arrayToCSV","header","rows","blob","Blob","URL","createObjectURL","downloadLink","document","createElement","csvTitle","toLowerCase","replace","setAttribute","click","downloadSVG","svg","getElementById","querySelector","outerHTML","href","download","body","appendChild","removeChild"],"sourceRoot":""}