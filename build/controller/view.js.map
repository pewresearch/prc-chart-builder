{"version":3,"file":"controller/view.js","mappings":"2CACA,IAAIA,EAAsB,CCA1BA,EAAwB,CAACC,EAASC,KACjC,IAAI,IAAIC,KAAOD,EACXF,EAAoBI,EAAEF,EAAYC,KAASH,EAAoBI,EAAEH,EAASE,IAC5EE,OAAOC,eAAeL,EAASE,EAAK,CAAEI,YAAY,EAAMC,IAAKN,EAAWC,IAE1E,ECNDH,EAAwB,CAACS,EAAKC,IAAUL,OAAOM,UAAUC,eAAeC,KAAKJ,EAAKC,ICIlF,MAAM,GAJGI,EAI8B,CAAE,WAAgB,IAAOC,EAAwE,WAAG,WAAgB,IAAOA,EAAwE,WAAG,MAAW,IAAOA,EAAmE,OAH7TC,EAAI,CAAC,EAAGhB,EAAoBiB,EAAED,EAAGF,GAAWE,ICI3C,aAAEE,GAAiBC,OAAOC,GAAGC,KAC3BC,WAAU,EAAEC,YAAWA,GAAKJ,ODN5B,IAACL,EACJE,EC6CL,MAAM,MAAEQ,IAAUC,EAAAA,EAAAA,OAAM,qCAAsC,CAC7DD,MAAO,CACN,YAAIE,GACH,MAAMC,GAAUC,EAAAA,EAAAA,eACV,GAAEC,GAAOF,EACTG,GAAUC,EAAAA,EAAAA,cAChB,OACCD,EAAQE,WAAW,qBAAuBR,EAAMK,GAAII,WACnDH,EAAQE,WAAW,uBACK,UAAxBR,EAAMK,GAAII,SAEb,GAEDC,UAAW,CACVC,MAAAA,GACC,MAAMR,GAAUC,EAAAA,EAAAA,cAChBQ,QAAQC,IAAI,YAAaV,EAASH,EACnC,GAEDc,QAAS,CACRC,YAAAA,GACC,MAAMZ,GAAUC,EAAAA,EAAAA,eACV,GAAEC,GAAOF,EACTG,GAAUC,EAAAA,EAAAA,cAChBP,EAAMK,GAAII,UAAYH,EAAQE,WAAW,kBAC1C,EACAQ,SAAAA,GACC,MAAMb,GAAUC,EAAAA,EAAAA,eACV,GAAEC,GAAOF,EACfH,EAAMK,GAAII,UAAY,OACvB,EACAQ,YAAAA,GACC,MAAMd,GAAUC,EAAAA,EAAAA,eACV,OAAEc,EAAM,QAAEC,EAAO,QAAEC,EAAO,MAAEC,EAAK,gBAAEC,GACxCnB,EACKoB,EAAY7B,EAAa,mCAAoC,CAClE8B,KAAMH,EACNxB,IAAKyB,EACF,GAAGF,WAAiBF,KAAUI,IAC9BH,IAEJxB,OAAO8B,KACNF,EACA,kBACA,8BAA8BxB,EAAc,EAAI,aAC/CD,EAAa,EAAI,qEAGpB,EACA4B,YAAAA,GACC,MAAMvB,GAAUC,EAAAA,EAAAA,eACV,OAAEc,EAAM,QAAEC,EAAO,QAAEC,EAAO,MAAEC,EAAK,gBAAEC,GACxCnB,EAIKoB,EAAY7B,EAAa,kCAAmC,CACjE8B,KAAM,GAAGH,KAJEC,EACT,GAAGF,WAAiBF,KAAUI,IAC9BH,MAIHxB,OAAO8B,KACNF,EACA,kBACA,8BAA8BxB,EAAc,EAAI,aAC/CD,EAAa,EAAI,qEAGpB,EACA6B,aAAAA,GACC,MAAMxB,GAAUC,EAAAA,EAAAA,eACV,OAAEc,EAAM,QAAEC,EAAO,QAAEC,EAAO,gBAAEE,GAAoBnB,EAChDoB,EAAY7B,EACjB,6CACA,CACCkC,EAAGN,EACA,GAAGF,WAAiBF,KAAUI,IAC9BH,IAGLxB,OAAO8B,KACNF,EACA,gBACA,8BAA8BxB,EAAc,EAAI,aAC/CD,EAAa,EAAI,qEAGpB,EACA+B,YAAAA,CAAaC,GACZ,MAAM3B,GAAUC,EAAAA,EAAAA,eACV,UACL2B,EAAS,MACTV,EAAK,SACLW,EAAQ,KACRC,EAAI,OACJC,EAAM,IACNC,EAAG,YACHC,GACGjC,EAEJ,GACgB,YAAf2B,EAAMO,OACS,UAAdP,EAAMnD,KAAiC,MAAdmD,EAAMnD,KAEhC,OAED,IAAKoD,EACJ,OAED,MAAMO,EA/IT,SAAoBC,EAAUC,GAC7B,QAAIC,IAAcF,GAAgC,IAApBA,EAASG,OAAc,OAAO,EAC5D,MAAMC,EACiDJ,EACjDK,EAAgBC,QAAiBJ,IAARI,EAAoBA,EAAM,GACzD,IAAIA,EAAM,QACNJ,IAAcD,IACjBK,GAAO,GAAGD,EAAaJ,EAASnB,iBAC7BuB,EAAaJ,EAASR,uBAI1B,IAAK,IAAIc,EAAI,EAAGA,EAAIH,EAAMD,OAAQI,GAAK,EAAG,CACzC,IAAIC,EAAO,GAEX,IAAK,IAAIC,EAAI,EAAGA,EAAIL,EAAMG,GAAGJ,OAAQM,GAAK,EACrCA,EAAI,IAAGD,GAAQ,KACfJ,EAAMG,GAAGE,GAAGC,QAAQ,MAAQ,EAC/BF,GAAQ,IAAIJ,EAAMG,GAAGE,MAErBD,GAAQJ,EAAMG,GAAGE,GAInBH,GAAO,GAAGE,SAEX,CAOA,YANIN,IAAcD,IACjBK,GAAO,SACLD,EAAaJ,EAASP,cACtBW,EAAaJ,EAASN,gBACtBU,EAAaJ,EAASL,QAElBU,CACR,CA6GeK,CAAW,CAACnB,EAAUoB,UAAWpB,EAAUqB,MAAO,CAC7D/B,QACAW,WACAC,OACAC,SACAC,QAEKkB,EAAO,IAAIC,KAAK,CAAChB,GAAM,CAAED,KAAM,aAC/BxC,EAAM0D,IAAIC,gBAAgBH,GAC1BI,EAAeC,SAASC,cAAc,KACtCC,EAAWvC,EAAMwC,cAAcC,QAAQ,OAAQ,KACrDL,EAAaM,aAAa,OAAQlE,GAClC4D,EAAaM,aACZ,WACA,GAAGH,UAAiBxB,SAErBqB,EAAaO,OACd,EACAC,WAAAA,GACC,MAAM9D,GAAUC,EAAAA,EAAAA,eACV,GAAEC,GAAOF,EAET+D,EADeR,SAASS,eAAe9D,GACpB+D,cAAc,OACvCF,EAAIH,aAAa,QAAS,8BAC1BG,EAAIH,aAAa,cAAe,gCAChC,MAAMV,EAAO,IAAIC,KAAK,CAACY,EAAIG,WAAY,CAAEhC,KAAM,kBACzCxC,EAAM0D,IAAIC,gBAAgBH,GAC1BI,EAAeC,SAASC,cAAc,KAC5CF,EAAaa,KAAOzE,EACpB4D,EAAac,SAAW,SAASlE,QACjCqD,SAASc,KAAKC,YAAYhB,GAC1BA,EAAaO,QACbN,SAASc,KAAKE,YAAYjB,EAC3B","sources":["webpack://@pewresearch/prc-chart-builder/webpack/bootstrap","webpack://@pewresearch/prc-chart-builder/webpack/runtime/define property getters","webpack://@pewresearch/prc-chart-builder/webpack/runtime/hasOwnProperty shorthand","webpack://@pewresearch/prc-chart-builder/external module \"@wordpress/interactivity\"","webpack://@pewresearch/prc-chart-builder/./src/controller/view.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","var x = (y) => {\n\tvar x = {}; __webpack_require__.d(x, y); return x\n} \nvar y = (x) => (() => (x))\nconst __WEBPACK_NAMESPACE_OBJECT__ = x({ [\"getContext\"]: () => (__WEBPACK_EXTERNAL_MODULE__wordpress_interactivity_8e89b257__.getContext), [\"getElement\"]: () => (__WEBPACK_EXTERNAL_MODULE__wordpress_interactivity_8e89b257__.getElement), [\"store\"]: () => (__WEBPACK_EXTERNAL_MODULE__wordpress_interactivity_8e89b257__.store) });","/**\n * WordPress Dependencies\n */\nimport { store, getElement, getContext } from '@wordpress/interactivity';\n\nconst { addQueryArgs } = window.wp.url;\nconst { innerWidth, innerHeight } = window;\n\n// convert array of arrays to formatted csv, with optional metadata\n// @see https://github.com/pewresearch/prc-scripts/blob/main/src/@prc/functions/functions.js#L145\nfunction arrayToCSV(objArray, metadata) {\n\tif (undefined === objArray || objArray.length === 0) return false;\n\tconst array =\n\t\t'object' !== typeof objArray ? JSON.parse(objArray) : objArray;\n\tconst checkIfEmpty = (str) => (str !== undefined ? str : '');\n\tlet str = '';\n\tif (undefined !== metadata) {\n\t\tstr += `${checkIfEmpty(metadata.title)}\n\t\t\t${checkIfEmpty(metadata.subtitle)}\n\n\t\t\t`;\n\t}\n\tfor (let i = 0; i < array.length; i += 1) {\n\t\tlet line = '';\n\t\t// if a value has a comma in it, wrap it in quotes\n\t\tfor (let j = 0; j < array[i].length; j += 1) {\n\t\t\tif (j > 0) line += ',';\n\t\t\tif (array[i][j].indexOf(',') > -1) {\n\t\t\t\tline += `\"${array[i][j]}\"`;\n\t\t\t} else {\n\t\t\t\tline += array[i][j];\n\t\t\t}\n\t\t}\n\n\t\tstr += `${line}\n\t\t`;\n\t}\n\tif (undefined !== metadata) {\n\t\tstr += `\n\t\t${checkIfEmpty(metadata.note)}\n\t\t${checkIfEmpty(metadata.source)}\n\t\t${checkIfEmpty(metadata.tag)}`;\n\t}\n\treturn str;\n}\n\nconst { state } = store('prc-block/chart-builder-controller', {\n\tstate: {\n\t\tget isActive() {\n\t\t\tconst context = getContext();\n\t\t\tconst { id } = context;\n\t\t\tconst element = getElement();\n\t\t\treturn (\n\t\t\t\telement.attributes['data-chart-view'] === state[id].activeTab ||\n\t\t\t\t(element.attributes['data-allow-overlay'] &&\n\t\t\t\t\tstate[id].activeTab === 'share')\n\t\t\t);\n\t\t},\n\t},\n\tcallbacks: {\n\t\tonInit() {\n\t\t\tconst context = getContext();\n\t\t\tconsole.log('ON INIT: ', context, state);\n\t\t},\n\t},\n\tactions: {\n\t\tsetActiveTab() {\n\t\t\tconst context = getContext();\n\t\t\tconst { id } = context;\n\t\t\tconst element = getElement();\n\t\t\tstate[id].activeTab = element.attributes['data-chart-view'];\n\t\t},\n\t\thideModal() {\n\t\t\tconst context = getContext();\n\t\t\tconst { id } = context;\n\t\t\tstate[id].activeTab = 'chart';\n\t\t},\n\t\tshareTwitter() {\n\t\t\tconst context = getContext();\n\t\t\tconst { postId, postUrl, rootUrl, title, featuredImageId } =\n\t\t\t\tcontext;\n\t\t\tconst actionUrl = addQueryArgs('https://twitter.com/intent/tweet', {\n\t\t\t\ttext: title,\n\t\t\t\turl: featuredImageId\n\t\t\t\t\t? `${rootUrl}/share/${postId}/${featuredImageId}`\n\t\t\t\t\t: postUrl,\n\t\t\t});\n\t\t\twindow.open(\n\t\t\t\tactionUrl,\n\t\t\t\t'twtrShareWindow',\n\t\t\t\t`height=450, width=550, top=${innerHeight / 2 - 275}, left=${\n\t\t\t\t\tinnerWidth / 2 - 225\n\t\t\t\t}, toolbar=0, location=0, menubar=0, directories=0, scrollbars=0`\n\t\t\t);\n\t\t},\n\t\tshareBluesky() {\n\t\t\tconst context = getContext();\n\t\t\tconst { postId, postUrl, rootUrl, title, featuredImageId } =\n\t\t\t\tcontext;\n\t\t\tconst url = featuredImageId\n\t\t\t\t? `${rootUrl}/share/${postId}/${featuredImageId}`\n\t\t\t\t: postUrl;\n\t\t\tconst actionUrl = addQueryArgs('https://bsky.app/intent/compose', {\n\t\t\t\ttext: `${title} ${url}`,\n\t\t\t});\n\t\t\twindow.open(\n\t\t\t\tactionUrl,\n\t\t\t\t'bskyShareWindow',\n\t\t\t\t`height=450, width=550, top=${innerHeight / 2 - 275}, left=${\n\t\t\t\t\tinnerWidth / 2 - 225\n\t\t\t\t}, toolbar=0, location=0, menubar=0, directories=0, scrollbars=0`\n\t\t\t);\n\t\t},\n\t\tshareFacebook() {\n\t\t\tconst context = getContext();\n\t\t\tconst { postId, postUrl, rootUrl, featuredImageId } = context;\n\t\t\tconst actionUrl = addQueryArgs(\n\t\t\t\t'https://www.facebook.com/sharer/sharer.php',\n\t\t\t\t{\n\t\t\t\t\tu: featuredImageId\n\t\t\t\t\t\t? `${rootUrl}/share/${postId}/${featuredImageId}`\n\t\t\t\t\t\t: postUrl,\n\t\t\t\t}\n\t\t\t);\n\t\t\twindow.open(\n\t\t\t\tactionUrl,\n\t\t\t\t'fbShareWindow',\n\t\t\t\t`height=450, width=550, top=${innerHeight / 2 - 275}, left=${\n\t\t\t\t\tinnerWidth / 2 - 225\n\t\t\t\t}, toolbar=0, location=0, menubar=0, directories=0, scrollbars=0`\n\t\t\t);\n\t\t},\n\t\tdownloadData(event) {\n\t\t\tconst context = getContext();\n\t\t\tconst {\n\t\t\t\ttableData,\n\t\t\t\ttitle,\n\t\t\t\tsubtitle,\n\t\t\t\tnote,\n\t\t\t\tsource,\n\t\t\t\ttag,\n\t\t\t\tpostPubDate,\n\t\t\t} = context;\n\t\t\t// If the event is a keydown event and the key is not Enter or space, return\n\t\t\tif (\n\t\t\t\tevent.type === 'keydown' &&\n\t\t\t\t(event.key !== 'Enter' || event.key !== ' ')\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (!tableData) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst csv = arrayToCSV([tableData.header, ...tableData.rows], {\n\t\t\t\ttitle,\n\t\t\t\tsubtitle,\n\t\t\t\tnote,\n\t\t\t\tsource,\n\t\t\t\ttag,\n\t\t\t});\n\t\t\tconst blob = new Blob([csv], { type: 'text/csv' });\n\t\t\tconst url = URL.createObjectURL(blob);\n\t\t\tconst downloadLink = document.createElement('a');\n\t\t\tconst csvTitle = title.toLowerCase().replace(/\\s+/g, '_');\n\t\t\tdownloadLink.setAttribute('href', url);\n\t\t\tdownloadLink.setAttribute(\n\t\t\t\t'download',\n\t\t\t\t`${csvTitle}_data_${postPubDate}.csv`\n\t\t\t);\n\t\t\tdownloadLink.click();\n\t\t},\n\t\tdownloadSVG() {\n\t\t\tconst context = getContext();\n\t\t\tconst { id } = context;\n\t\t\tconst controllerEl = document.getElementById(id);\n\t\t\tconst svg = controllerEl.querySelector('svg');\n\t\t\tsvg.setAttribute('xmlns', 'http://www.w3.org/2000/svg');\n\t\t\tsvg.setAttribute('xmlns:xlink', 'http://www.w3.org/1999/xlink');\n\t\t\tconst blob = new Blob([svg.outerHTML], { type: 'image/svg+xml' });\n\t\t\tconst url = URL.createObjectURL(blob);\n\t\t\tconst downloadLink = document.createElement('a');\n\t\t\tdownloadLink.href = url;\n\t\t\tdownloadLink.download = `chart-${id}.svg`;\n\t\t\tdocument.body.appendChild(downloadLink);\n\t\t\tdownloadLink.click();\n\t\t\tdocument.body.removeChild(downloadLink);\n\t\t},\n\t},\n});\n"],"names":["__webpack_require__","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","y","__WEBPACK_EXTERNAL_MODULE__wordpress_interactivity_8e89b257__","x","d","addQueryArgs","window","wp","url","innerWidth","innerHeight","state","store","isActive","context","getContext","id","element","getElement","attributes","activeTab","callbacks","onInit","console","log","actions","setActiveTab","hideModal","shareTwitter","postId","postUrl","rootUrl","title","featuredImageId","actionUrl","text","open","shareBluesky","shareFacebook","u","downloadData","event","tableData","subtitle","note","source","tag","postPubDate","type","csv","objArray","metadata","undefined","length","array","checkIfEmpty","str","i","line","j","indexOf","arrayToCSV","header","rows","blob","Blob","URL","createObjectURL","downloadLink","document","createElement","csvTitle","toLowerCase","replace","setAttribute","click","downloadSVG","svg","getElementById","querySelector","outerHTML","href","download","body","appendChild","removeChild"],"sourceRoot":""}